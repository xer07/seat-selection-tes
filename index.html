
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>ã€æ¸¬è©¦ç‰ˆã€‘Echoes of youth æ°¸è±éŸ“æµæœ€çµ‚å¤§æˆ - åŠƒä½</title>
  <style>
    body { font-family: sans-serif; padding: 10px; }
    .seat { width: 27px; height: 27px; margin: 2px; text-align: center; line-height: 27px; border: 1px solid #999; border-radius: 5px; cursor: pointer; user-select: none; display: inline-block; font-size: 14px; }
    .selected { background-color: #4CAF50; color: white; }
    .unavailable { background-color: #ccc; cursor: not-allowed; }
    .row { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
    .group { display: flex; margin: 3px 0; }
    .row-label { font-weight: bold; margin-bottom: 3px; text-align: center; }
    .controls { margin-top: 10px; text-align: center; }
    #result { white-space: pre-wrap; margin-top: 10px; text-align:center; }
    .stage-label { text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 10px; }
  </style>
</head>
<body>
<h3 style="text-align:center;">ã€æ¸¬è©¦ç‰ˆã€‘åŠƒä½è¡¨å–®</h3>
<p><strong>åç¨±:</strong> Echoes of youth æ°¸è±éŸ“æµæœ€çµ‚å¤§æˆ</p>
<p><strong>æ™‚é–“:</strong> 2025/08/15 (äº”) 15:20</p>
<p><strong>åœ°é»:</strong> æ¡ƒåœ’å¸‚æ”¿åºœæ–‡åŒ–å±€æ¼”è—å»³</p>

<p>
  <label for="username">å§“åï¼š</label>
  <input type="text" id="username" name="username" required>
</p>

<div class="stage-label">èˆå°æ–¹å‘ â†‘</div>
<div id="seat-container"></div>

<div class="controls">
  <button type="button" onclick="submitSelection()">é€å‡º</button>
</div>

<div id="result"></div>

<script>
const scriptUrl = 'https://script.google.com/macros/s/AKfycbwMo0WV_1Wh81NX-_RwR1afGTBqzoWj6qWCBxDhQgyLJeFI-kjuhKLe6ZPHPIua77FsQA/exec';
const unavailableSeats = new Set();
const selectedSeats = new Set();
const seatConfig = {};
const container = document.getElementById('seat-container');

for (let i = 1; i <= 14; i++) unavailableSeats.add(`1-${i}`);
for (let row = 2; row <= 3; row++) for (let i = 1; i <= 8; i++) unavailableSeats.add(`${row}-${i}`);
for (let row = 11; row <= 23; row++) for (let i = 9; i <= 24; i++) unavailableSeats.add(`${row}-${i}`);

for (let row = 1; row <= 23; row++) {
  seatConfig[row] = [23,21,19,17,15,13,11,9,7,5,3,1,2,4,6,8,10,12,14,16,18,20,22,24];
}

function renderSeats() {
  container.innerHTML = '';
  for (const row in seatConfig) {
    const rowDiv = document.createElement('div');
    rowDiv.className = 'row';
    const rowLabel = document.createElement('div');
    rowLabel.className = 'row-label';
    rowLabel.textContent = `ç¬¬${row}æ’`;
    rowDiv.appendChild(rowLabel);

    const leftGroup = document.createElement('div');
    leftGroup.className = 'group';
    seatConfig[row].slice(0,8).forEach(seatNum => leftGroup.appendChild(createSeatElement(row, seatNum)));

    const centerGroup = document.createElement('div');
    centerGroup.className = 'group';
    seatConfig[row].slice(8,16).forEach(seatNum => centerGroup.appendChild(createSeatElement(row, seatNum)));

    const rightGroup = document.createElement('div');
    rightGroup.className = 'group';
    seatConfig[row].slice(16).forEach(seatNum => rightGroup.appendChild(createSeatElement(row, seatNum)));

    rowDiv.appendChild(leftGroup);
    rowDiv.appendChild(centerGroup);
    rowDiv.appendChild(rightGroup);

    container.appendChild(rowDiv);
  }
}

function createSeatElement(row, seatNum) {
  const seatId = `${row}-${seatNum}`;
  const seat = document.createElement('div');
  seat.className = 'seat';
  seat.textContent = seatNum;
  if (unavailableSeats.has(seatId)) seat.classList.add('unavailable');
  seat.addEventListener('click', () => {
    if (seat.classList.contains('unavailable')) return;
    if (selectedSeats.has(seatId)) {
      selectedSeats.delete(seatId);
      seat.classList.remove('selected');
    } else {
      selectedSeats.add(seatId);
      seat.classList.add('selected');
    }
  });
  return seat;
}

function submitSelection() {
  const name = document.getElementById('username').value.trim();
  if (!name) return alert('è«‹è¼¸å…¥å§“åï¼');
  if (selectedSeats.size === 0) return alert('å°šæœªé¸æ“‡ä»»ä½•åº§ä½ï¼');
  const seats = Array.from(selectedSeats).join(', ');
  if (confirm(`è«‹ç¢ºèªï¼š\nå§“å: ${name}\nåº§ä½: ${seats}`)) {
    fetch(scriptUrl, {
      method: 'POST',
      body: new URLSearchParams({ name, seats, source: 'æ¸¬è©¦ç‰ˆ' })
    })
    .then(res => res.text())
    .then(() => {
      alert('é€å‡ºæˆåŠŸï¼');
      document.getElementById('result').innerText = `å§“å: ${name}\nå·²é€å‡ºåº§ä½ï¼š${seats}`;
      seats.split(',').map(s => s.trim()).forEach(seatId => {
        unavailableSeats.add(seatId);
        selectedSeats.delete(seatId);
      });
      renderSeats();
    })
    .catch(err => {
      alert('é€å‡ºå¤±æ•—ï¼');
      console.error(err);
    });
  }
}

fetch(scriptUrl)
  .then(res => res.json())
  .then(data => {
    data.forEach(seatId => unavailableSeats.add(seatId));
    renderSeats();
  })
  .catch(err => {
    alert('ç„¡æ³•è¼‰å…¥å·²é¸åº§ä½è³‡æ–™');
    console.error(err);
    renderSeats();

    setInterval(() => {
  fetch(scriptUrl)
    .then(res => res.json())
    .then(data => {
      unavailableSeats.clear();
      for (let i = 1; i <= 14; i++) unavailableSeats.add(`1-${i}`);
      for (let row = 2; row <= 3; row++) for (let i = 1; i <= 8; i++) unavailableSeats.add(`${row}-${i}`);
      for (let row = 11; row <= 23; row++) for (let i = 9; i <= 24; i++) unavailableSeats.add(`${row}-${i}`);
      data.forEach(seatId => unavailableSeats.add(seatId));
      renderSeats();
    })
    .catch(err => console.error('åº§ä½åŒæ­¥å¤±æ•—', err));
}, 5000); // æ¯5ç§’è‡ªå‹•åŒæ­¥

  });
</script>
  <div class="controls" style="margin-top:20px; text-align:center;">
  <button onclick="adminClearAll()">ğŸ§¹ ç®¡ç†å“¡æ¸…ç©ºå…¨éƒ¨åº§ä½</button>
</div>

<script>
function adminClearAll() {
  if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å·²åŠƒä½ç´€éŒ„å—ï¼Ÿ')) {
    fetch(scriptUrl + '?clearAll=true')
      .then(res => res.json())
      .then(result => {
        if (result.status === 'cleared') {
          alert('âœ… æ‰€æœ‰åº§ä½å·²æ¸…ç©º');
          unavailableSeats.clear();
          fetch(scriptUrl)
            .then(res => res.json())
            .then(data => {
              data.forEach(seatId => unavailableSeats.add(seatId));
              renderSeats();
            });
        } else {
          alert('âŒ æ¸…é™¤å¤±æ•—');
        }
      })
      .catch(err => {
        alert('âŒ ç„¡æ³•æ¸…é™¤è³‡æ–™');
        console.error(err);
      });
  }
}
</script>

</body>
</html>
